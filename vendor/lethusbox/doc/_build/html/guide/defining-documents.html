
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Defining documents &mdash; LethusBox  documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="LethusBox  documentation" href="../index.html" />
    <link rel="up" title="User Guide" href="index.html" />
    <link rel="next" title="Documents instances" href="document-instances.html" />
    <link rel="prev" title="Connecting to MongoDB" href="connecting.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="document-instances.html" title="Documents instances"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="connecting.html" title="Connecting to MongoDB"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">LethusBox  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">User Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="defining-documents">
<h1>Defining documents<a class="headerlink" href="#defining-documents" title="Permalink to this headline">¶</a></h1>
<p>In MongoDB, a <strong>document</strong> is roughly equivalent to a <strong>row</strong> in an RDBMS. When
working with relational databases, rows are stored in <strong>tables</strong>, which have a
strict <strong>schema</strong> that the rows follow. MongoDB stores documents in
<strong>collections</strong> rather than tables - the principle difference is that no schema
is enforced at a database level.</p>
<div class="section" id="defining-a-document-s-schema">
<h2>Defining a document&#8217;s schema<a class="headerlink" href="#defining-a-document-s-schema" title="Permalink to this headline">¶</a></h2>
<p>MongoEngine allows you to define schemata for documents as this helps to reduce
coding errors, and allows for utility methods to be defined on fields which may
be present.</p>
<p>To define a schema for a document, create a class that inherits from
<tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt>. Fields are specified by adding <strong>field
objects</strong> as class attributes to the document class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">mongoengine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">date_modified</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-document-schemas">
<h2>Dynamic document schemas<a class="headerlink" href="#dynamic-document-schemas" title="Permalink to this headline">¶</a></h2>
<p>One of the benefits of MongoDb is dynamic schemas for a collection, whilst data
should be planned and organised (after all explicit is better than implicit!)
there are scenarios where having dynamic / expando style documents is desirable.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">DynamicDocument</span></tt> documents work in the same way as
<tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt> but any data / attributes set to them will also
be saved</p>
<div class="highlight-python"><pre>from mongoengine import *

class Page(DynamicDocument):
    title = StringField(max_length=200, required=True)

# Create a new page and add tags
&gt;&gt;&gt; page = Page(title='Using MongoEngine')
&gt;&gt;&gt; page.tags = ['mongodb', 'mongoengine']
&gt;&gt;&gt; page.save()

&gt;&gt;&gt; Page.objects(tags='mongoengine').count()
&gt;&gt;&gt; 1</pre>
</div>
<p>..note:</p>
<div class="highlight-python"><pre>There is one caveat on Dynamic Documents: fields cannot start with `_`</pre>
</div>
</div>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>By default, fields are not required. To make a field mandatory, set the
<tt class="xref py py-attr docutils literal"><span class="pre">required</span></tt> keyword argument of a field to <tt class="docutils literal"><span class="pre">True</span></tt>. Fields also may have
validation constraints available (such as <tt class="xref py py-attr docutils literal"><span class="pre">max_length</span></tt> in the example
above). Fields may also take default values, which will be used if a value is
not provided. Default values may optionally be a callable, which will be called
to retrieve the value (such as in the above example). The field types available
are as follows:</p>
<ul class="simple">
<li><tt class="xref py py-class docutils literal"><span class="pre">BinaryField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">BooleanField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">ComplexDateTimeField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">DecimalField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">DictField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">DynamicField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">EmailField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">EmbeddedDocumentField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">FileField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">FloatField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">GenericEmbeddedDocumentField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">GenericReferenceField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">GeoPointField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">ImageField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">IntField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">ListField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">MapField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">ObjectIdField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">SequenceField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">SortedListField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">StringField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">URLField</span></tt></li>
<li><tt class="xref py py-class docutils literal"><span class="pre">UUIDField</span></tt></li>
</ul>
<div class="section" id="field-arguments">
<h3>Field arguments<a class="headerlink" href="#field-arguments" title="Permalink to this headline">¶</a></h3>
<p>Each field type can be customized by keyword arguments.  The following keyword
arguments can be set on all fields:</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">db_field</span></tt> (Default: None)</dt>
<dd>The MongoDB field name.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">name</span></tt> (Default: None)</dt>
<dd>The mongoengine field name.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">required</span></tt> (Default: False)</dt>
<dd>If set to True and the field is not set on the document instance, a
<tt class="xref py py-class docutils literal"><span class="pre">ValidationError</span></tt> will be raised when the document is
validated.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">default</span></tt> (Default: None)</dt>
<dd><p class="first">A value to use when no value is set for this field.</p>
<p>The definion of default parameters follow <a class="reference external" href="http://docs.python.org/reference/compound_stmts.html#function-definitions">the general rules on Python</a>,
which means that some care should be taken when dealing with default mutable objects
(like in <tt class="xref py py-class docutils literal"><span class="pre">ListField</span></tt> or <tt class="xref py py-class docutils literal"><span class="pre">DictField</span></tt>):</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ExampleFirst</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="c"># Default an empty list</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">IntField</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ExampleSecond</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="c"># Default a set of values</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">IntField</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">ExampleDangerous</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="c"># This can make an .append call to  add values to the default (and all the following objects),</span>
    <span class="c"># instead to just an object</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">IntField</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">unique</span></tt> (Default: False)</dt>
<dd>When True, no documents in the collection will have the same value for this
field.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">unique_with</span></tt> (Default: None)</dt>
<dd>A field name (or list of field names) that when taken together with this
field, will not have two documents in the collection with the same value.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">primary_key</span></tt> (Default: False)</dt>
<dd>When True, use this field as a primary key for the collection.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">choices</span></tt> (Default: None)</dt>
<dd><p class="first">An iterable (e.g. a list or tuple) of choices to which the value of this
field should be limited.</p>
<p>Can be either be a nested tuples of value (stored in mongo) and a
human readable key</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SIZE</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;Small&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;Medium&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">,</span> <span class="s">&#39;Large&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;XL&#39;</span><span class="p">,</span> <span class="s">&#39;Extra Large&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;XXL&#39;</span><span class="p">,</span> <span class="s">&#39;Extra Extra Large&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">Shirt</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SIZE</span><span class="p">)</span>
</pre></div>
</div>
<p>Or a flat iterable just containing values</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;L&#39;</span><span class="p">,</span> <span class="s">&#39;XL&#39;</span><span class="p">,</span> <span class="s">&#39;XXL&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Shirt</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SIZE</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">help_text</span></tt> (Default: None)</dt>
<dd>Optional help text to output with the field - used by form libraries</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">verbose_name</span></tt> (Default: None)</dt>
<dd>Optional human-readable name for the field - used by form libraries</dd>
</dl>
</div>
<div class="section" id="list-fields">
<h3>List fields<a class="headerlink" href="#list-fields" title="Permalink to this headline">¶</a></h3>
<p>MongoDB allows the storage of lists of items. To add a list of items to a
<tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt>, use the <tt class="xref py py-class docutils literal"><span class="pre">ListField</span></tt> field
type. <tt class="xref py py-class docutils literal"><span class="pre">ListField</span></tt> takes another field object as its first
argument, which specifies which type elements may be stored within the list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="embedded-documents">
<h3>Embedded documents<a class="headerlink" href="#embedded-documents" title="Permalink to this headline">¶</a></h3>
<p>MongoDB has the ability to embed documents within other documents. Schemata may
be defined for these embedded documents, just as they may be for regular
documents. To create an embedded document, just define a document as usual, but
inherit from <tt class="xref py py-class docutils literal"><span class="pre">EmbeddedDocument</span></tt> rather than
<tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">EmbeddedDocument</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
</pre></div>
</div>
<p>To embed the document within another document, use the
<tt class="xref py py-class docutils literal"><span class="pre">EmbeddedDocumentField</span></tt> field type, providing the embedded
document class as the first argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">EmbeddedDocumentField</span><span class="p">(</span><span class="n">Comment</span><span class="p">))</span>

<span class="n">comment1</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&#39;Good work!&#39;</span><span class="p">)</span>
<span class="n">comment2</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&#39;Nice article!&#39;</span><span class="p">)</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">comments</span><span class="o">=</span><span class="p">[</span><span class="n">comment1</span><span class="p">,</span> <span class="n">comment2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="dictionary-fields">
<h3>Dictionary Fields<a class="headerlink" href="#dictionary-fields" title="Permalink to this headline">¶</a></h3>
<p>Often, an embedded document may be used instead of a dictionary &#8211; generally
this is recommended as dictionaries don&#8217;t support validation or custom field
types. However, sometimes you will not know the structure of what you want to
store; in this situation a <tt class="xref py py-class docutils literal"><span class="pre">DictField</span></tt> is appropriate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SurveyResponse</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ReferenceField</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="n">DictField</span><span class="p">()</span>

<span class="n">survey_response</span> <span class="o">=</span> <span class="n">SurveyResponse</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<span class="n">response_form</span> <span class="o">=</span> <span class="n">ResponseForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
<span class="n">survey_response</span><span class="o">.</span><span class="n">answers</span> <span class="o">=</span> <span class="n">response_form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">()</span>
<span class="n">survey_response</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Dictionaries can store complex data, other dictionaries, lists, references to
other objects, so are the most flexible field type available.</p>
</div>
<div class="section" id="reference-fields">
<h3>Reference fields<a class="headerlink" href="#reference-fields" title="Permalink to this headline">¶</a></h3>
<p>References may be stored to other documents in the database using the
<tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt>. Pass in another document class as the
first argument to the constructor, then simply assign document objects to the
field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">ReferenceField</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="n">john</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Smith&quot;</span><span class="p">)</span>
<span class="n">john</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&quot;Test Page&quot;</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">john</span>
<span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">User</span></tt> object is automatically turned into a reference behind the
scenes, and dereferenced when the <tt class="xref py py-class docutils literal"><span class="pre">Page</span></tt> object is retrieved.</p>
<p>To add a <tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt> that references the document
being defined, use the string <tt class="docutils literal"><span class="pre">'self'</span></tt> in place of the document class as the
argument to <tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt>&#8216;s constructor. To reference a
document that has not yet been defined, use the name of the undefined document
as the constructor&#8217;s argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">boss</span> <span class="o">=</span> <span class="n">ReferenceField</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">)</span>
    <span class="n">profile_page</span> <span class="o">=</span> <span class="n">ReferenceField</span><span class="p">(</span><span class="s">&#39;ProfilePage&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ProfilePage</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="one-to-many-with-listfields">
<span id="id1"></span><h4>One to Many with ListFields<a class="headerlink" href="#one-to-many-with-listfields" title="Permalink to this headline">¶</a></h4>
<p>If you are implementing a one to many relationship via a list of references,
then the references are stored as DBRefs and to query you need to pass an
instance of the object to the query:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">ListField</span><span class="p">(</span><span class="n">ReferenceField</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>

<span class="n">bob</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob Jones&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Smith&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">Page</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&quot;Test Page&quot;</span><span class="p">,</span> <span class="n">authors</span><span class="o">=</span><span class="p">[</span><span class="n">bob</span><span class="p">,</span> <span class="n">john</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">Page</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&quot;Another Page&quot;</span><span class="p">,</span> <span class="n">authors</span><span class="o">=</span><span class="p">[</span><span class="n">john</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c"># Find all pages Bob authored</span>
<span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">authors__in</span><span class="o">=</span><span class="p">[</span><span class="n">bob</span><span class="p">])</span>

<span class="c"># Find all pages that both Bob and John have authored</span>
<span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="n">authors__all</span><span class="o">=</span><span class="p">[</span><span class="n">bob</span><span class="p">,</span> <span class="n">john</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="dealing-with-deletion-of-referred-documents">
<h4>Dealing with deletion of referred documents<a class="headerlink" href="#dealing-with-deletion-of-referred-documents" title="Permalink to this headline">¶</a></h4>
<p>By default, MongoDB doesn&#8217;t check the integrity of your data, so deleting
documents that other documents still hold references to will lead to consistency
issues.  Mongoengine&#8217;s <tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt> adds some functionality to
safeguard against these kinds of database integrity problems, providing each
reference with a delete rule specification.  A delete rule is specified by
supplying the <tt class="xref py py-attr docutils literal"><span class="pre">reverse_delete_rule</span></tt> attributes on the
<tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt> definition, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">profile_page</span> <span class="o">=</span> <span class="n">ReferenceField</span><span class="p">(</span><span class="s">&#39;ProfilePage&#39;</span><span class="p">,</span> <span class="n">reverse_delete_rule</span><span class="o">=</span><span class="n">mongoengine</span><span class="o">.</span><span class="n">NULLIFY</span><span class="p">)</span>
</pre></div>
</div>
<p>The declaration in this example means that when an <tt class="xref py py-class docutils literal"><span class="pre">Employee</span></tt> object is
removed, the <tt class="xref py py-class docutils literal"><span class="pre">ProfilePage</span></tt> that belongs to that employee is removed as
well.  If a whole batch of employees is removed, all profile pages that are
linked are removed as well.</p>
<p>Its value can take any of the following constants:</p>
<dl class="docutils">
<dt><tt class="xref py py-const docutils literal"><span class="pre">mongoengine.DO_NOTHING</span></tt></dt>
<dd>This is the default and won&#8217;t do anything.  Deletes are fast, but may cause
database inconsistency or dangling references.</dd>
<dt><tt class="xref py py-const docutils literal"><span class="pre">mongoengine.DENY</span></tt></dt>
<dd>Deletion is denied if there still exist references to the object being
deleted.</dd>
<dt><tt class="xref py py-const docutils literal"><span class="pre">mongoengine.NULLIFY</span></tt></dt>
<dd>Any object&#8217;s fields still referring to the object being deleted are removed
(using MongoDB&#8217;s &#8220;unset&#8221; operation), effectively nullifying the relationship.</dd>
<dt><tt class="xref py py-const docutils literal"><span class="pre">mongoengine.CASCADE</span></tt></dt>
<dd>Any object containing fields that are refererring to the object being deleted
are deleted first.</dd>
<dt><tt class="xref py py-const docutils literal"><span class="pre">mongoengine.PULL</span></tt></dt>
<dd>Removes the reference to the object (using MongoDB&#8217;s &#8220;pull&#8221; operation)
from any object&#8217;s fields of
<tt class="xref py py-class docutils literal"><span class="pre">ListField</span></tt> (<tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt>).</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>A safety note on setting up these delete rules!  Since the delete rules are
not recorded on the database level by MongoDB itself, but instead at runtime,
in-memory, by the MongoEngine module, it is of the upmost importance
that the module that declares the relationship is loaded <strong>BEFORE</strong> the
delete is invoked.</p>
<p>If, for example, the <tt class="xref py py-class docutils literal"><span class="pre">Employee</span></tt> object lives in the
<tt class="xref py py-mod docutils literal"><span class="pre">payroll</span></tt> app, and the <tt class="xref py py-class docutils literal"><span class="pre">ProfilePage</span></tt> in the <tt class="xref py py-mod docutils literal"><span class="pre">people</span></tt>
app, it is extremely important that the <tt class="xref py py-mod docutils literal"><span class="pre">people</span></tt> app is loaded
before any employee is removed, because otherwise, MongoEngine could
never know this relationship exists.</p>
<p class="last">In Django, be sure to put all apps that have such delete rule declarations in
their <tt class="file docutils literal"><span class="pre">models.py</span></tt> in the <tt class="xref py py-const docutils literal"><span class="pre">INSTALLED_APPS</span></tt> tuple.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Signals are not triggered when doing cascading updates / deletes - if this
is required you must manually handle the update / delete.</p>
</div>
</div>
<div class="section" id="generic-reference-fields">
<h4>Generic reference fields<a class="headerlink" href="#generic-reference-fields" title="Permalink to this headline">¶</a></h4>
<p>A second kind of reference field also exists,
<tt class="xref py py-class docutils literal"><span class="pre">GenericReferenceField</span></tt>. This allows you to reference any
kind of <tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt>, and hence doesn&#8217;t take a
<tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt> subclass as a constructor argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Bookmark</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">bookmark_object</span> <span class="o">=</span> <span class="n">GenericReferenceField</span><span class="p">()</span>

<span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;http://hmarr.com/mongoengine/&#39;</span><span class="p">)</span>
<span class="n">link</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Using MongoEngine&#39;</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">Bookmark</span><span class="p">(</span><span class="n">bookmark_object</span><span class="o">=</span><span class="n">link</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">Bookmark</span><span class="p">(</span><span class="n">bookmark_object</span><span class="o">=</span><span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using <tt class="xref py py-class docutils literal"><span class="pre">GenericReferenceField</span></tt>s is slightly less
efficient than the standard <tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt>s, so if
you will only be referencing one document type, prefer the standard
<tt class="xref py py-class docutils literal"><span class="pre">ReferenceField</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="uniqueness-constraints">
<h3>Uniqueness constraints<a class="headerlink" href="#uniqueness-constraints" title="Permalink to this headline">¶</a></h3>
<p>MongoEngine allows you to specify that a field should be unique across a
collection by providing <tt class="docutils literal"><span class="pre">unique=True</span></tt> to a <tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt>&#8216;s
constructor. If you try to save a document that has the same value for a unique
field as a document that is already in the database, a
<tt class="xref py py-class docutils literal"><span class="pre">OperationError</span></tt> will be raised. You may also specify
multi-field uniqueness constraints by using <tt class="xref py py-attr docutils literal"><span class="pre">unique_with</span></tt>, which may be
either a single field name, or a list or tuple of field names:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">unique_with</span><span class="o">=</span><span class="s">&#39;first_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="skipping-document-validation-on-save">
<h3>Skipping Document validation on save<a class="headerlink" href="#skipping-document-validation-on-save" title="Permalink to this headline">¶</a></h3>
<p>You can also skip the whole document validation process by setting
<tt class="docutils literal"><span class="pre">validate=False</span></tt> when caling the <tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt>
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Recipient</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">EmailField</span><span class="p">()</span>

<span class="n">recipient</span> <span class="o">=</span> <span class="n">Recipient</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">&#39;root@localhost&#39;</span><span class="p">)</span>
<span class="n">recipient</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>               <span class="c"># will raise a ValidationError while</span>
<span class="n">recipient</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># won&#39;t</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="document-collections">
<h2>Document collections<a class="headerlink" href="#document-collections" title="Permalink to this headline">¶</a></h2>
<p>Document classes that inherit <strong>directly</strong> from <tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt>
will have their own <strong>collection</strong> in the database. The name of the collection
is by default the name of the class, coverted to lowercase (so in the example
above, the collection would be called <cite>page</cite>). If you need to change the name
of the collection (e.g. to use MongoEngine with an existing database), then
create a class dictionary attribute called <tt class="xref py py-attr docutils literal"><span class="pre">meta</span></tt> on your document, and
set <tt class="xref py py-attr docutils literal"><span class="pre">collection</span></tt> to the name of the collection that you want your
document class to use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;collection&#39;</span><span class="p">:</span> <span class="s">&#39;cmsPage&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="section" id="capped-collections">
<h3>Capped collections<a class="headerlink" href="#capped-collections" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt> may use a <strong>Capped Collection</strong> by specifying
<tt class="xref py py-attr docutils literal"><span class="pre">max_documents</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">max_size</span></tt> in the <tt class="xref py py-attr docutils literal"><span class="pre">meta</span></tt> dictionary.
<tt class="xref py py-attr docutils literal"><span class="pre">max_documents</span></tt> is the maximum number of documents that is allowed to be
stored in the collection, and <tt class="xref py py-attr docutils literal"><span class="pre">max_size</span></tt> is the maximum size of the
collection in bytes. If <tt class="xref py py-attr docutils literal"><span class="pre">max_size</span></tt> is not specified and
<tt class="xref py py-attr docutils literal"><span class="pre">max_documents</span></tt> is, <tt class="xref py py-attr docutils literal"><span class="pre">max_size</span></tt> defaults to 10000000 bytes (10MB).
The following example shows a <tt class="xref py py-class docutils literal"><span class="pre">Log</span></tt> document that will be limited to
1000 entries and 2MB of disk space:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Log</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;max_documents&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">&#39;max_size&#39;</span><span class="p">:</span> <span class="mi">2000000</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexes">
<h2>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h2>
<p>You can specify indexes on collections to make querying faster. This is done
by creating a list of index specifications called <tt class="xref py py-attr docutils literal"><span class="pre">indexes</span></tt> in the
<tt class="xref py py-attr docutils literal"><span class="pre">meta</span></tt> dictionary, where an index specification may
either be a single field name, a tuple containing multiple field names, or a
dictionary containing a full index definition. A direction may be specified on
fields by prefixing the field name with a <strong>+</strong> or a <strong>-</strong> sign. Note that
direction only matters on multi-field indexes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">rating</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;indexes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;-rating&#39;</span><span class="p">)]</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>If a dictionary is passed then the following options are available:</p>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">fields</span></tt> (Default: None)</dt>
<dd>The fields to index. Specified in the same format as described above.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">types</span></tt> (Default: True)</dt>
<dd>Whether the index should have the <tt class="xref py py-attr docutils literal"><span class="pre">_types</span></tt> field added automatically
to the start of the index.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">sparse</span></tt> (Default: False)</dt>
<dd>Whether the index should be sparse.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">unique</span></tt> (Default: False)</dt>
<dd>Whether the index should be sparse.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To index embedded files / dictionary fields use &#8216;dot&#8217; notation eg:
<cite>rank.title</cite></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Inheritance adds extra indices.
If don&#8217;t need inheritance for a document turn inheritance off -
see <a class="reference internal" href="#document-inheritance"><em>Document inheritance</em></a>.</p>
</div>
<div class="section" id="geospatial-indexes">
<h3>Geospatial indexes<a class="headerlink" href="#geospatial-indexes" title="Permalink to this headline">¶</a></h3>
<p>Geospatial indexes will be automatically created for all
<tt class="xref py py-class docutils literal"><span class="pre">GeoPointField</span></tt>s</p>
<p>It is also possible to explicitly define geospatial indexes. This is
useful if you need to define a geospatial index on a subfield of a
<tt class="xref py py-class docutils literal"><span class="pre">DictField</span></tt> or a custom field that contains a
point. To create a geospatial index you must prefix the field with the
<strong>*</strong> sign.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Place</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">DictField</span><span class="p">()</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;indexes&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&#39;*location.point&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ordering">
<h2>Ordering<a class="headerlink" href="#ordering" title="Permalink to this headline">¶</a></h2>
<p>A default ordering can be specified for your
<tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt> using the <tt class="xref py py-attr docutils literal"><span class="pre">ordering</span></tt> attribute of
<tt class="xref py py-attr docutils literal"><span class="pre">meta</span></tt>.  Ordering will be applied when the
<tt class="xref py py-class docutils literal"><span class="pre">QuerySet</span></tt> is created, and can be overridden by
subsequent calls to <tt class="xref py py-meth docutils literal"><span class="pre">order_by()</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">published_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;ordering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;-published_date&#39;</span><span class="p">]</span>
    <span class="p">}</span>

<span class="n">blog_post_1</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Blog Post #1&quot;</span><span class="p">)</span>
<span class="n">blog_post_1</span><span class="o">.</span><span class="n">published_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">blog_post_2</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Blog Post #2&quot;</span><span class="p">)</span>
<span class="n">blog_post_2</span><span class="o">.</span><span class="n">published_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">blog_post_3</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Blog Post #3&quot;</span><span class="p">)</span>
<span class="n">blog_post_3</span><span class="o">.</span><span class="n">published_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">blog_post_1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">blog_post_2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">blog_post_3</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c"># get the &quot;first&quot; BlogPost using default ordering</span>
<span class="c"># from BlogPost.meta.ordering</span>
<span class="n">latest_post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">latest_post</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s">&quot;Blog Post #3&quot;</span>

<span class="c"># override default ordering, order BlogPosts by &quot;published_date&quot;</span>
<span class="n">first_post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;+published_date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">first_post</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s">&quot;Blog Post #1&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="shard-keys">
<h2>Shard keys<a class="headerlink" href="#shard-keys" title="Permalink to this headline">¶</a></h2>
<p>If your collection is sharded, then you need to specify the shard key as a tuple,
using the <tt class="xref py py-attr docutils literal"><span class="pre">shard_key</span></tt> attribute of <tt class="xref py py-attr docutils literal"><span class="pre">-mongoengine.Document.meta</span></tt>.
This ensures that the shard key is sent with the query when calling the
<tt class="xref py py-meth docutils literal"><span class="pre">save()</span></tt> or
<tt class="xref py py-meth docutils literal"><span class="pre">update()</span></tt> method on an existing
<tt class="xref py py-class docutils literal"><span class="pre">-mongoengine.Document</span></tt> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LogEntry</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">machine</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">()</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;shard_key&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;machine&#39;</span><span class="p">,</span> <span class="s">&#39;timestamp&#39;</span><span class="p">,)</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="document-inheritance">
<span id="id2"></span><h2>Document inheritance<a class="headerlink" href="#document-inheritance" title="Permalink to this headline">¶</a></h2>
<p>To create a specialised type of a <tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt> you have
defined, you may subclass it and add any extra fields or methods you may need.
As this is new class is not a direct subclass of
<tt class="xref py py-class docutils literal"><span class="pre">Document</span></tt>, it will not be stored in its own collection; it
will use the same collection as its superclass uses. This allows for more
convenient and efficient retrieval of related documents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Stored in a collection named &#39;page&#39;</span>
<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;allow_inheritance&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>

<span class="c"># Also stored in the collection named &#39;page&#39;</span>
<span class="k">class</span> <span class="nc">DatedPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">From 0.7 onwards you must declare <cite>allow_inheritance</cite> in the document meta.</p>
</div>
<div class="section" id="working-with-existing-data">
<h3>Working with existing data<a class="headerlink" href="#working-with-existing-data" title="Permalink to this headline">¶</a></h3>
<p>To enable correct retrieval of documents involved in this kind of heirarchy,
two extra attributes are stored on each document in the database: <tt class="xref py py-attr docutils literal"><span class="pre">_cls</span></tt>
and <tt class="xref py py-attr docutils literal"><span class="pre">_types</span></tt>. These are hidden from the user through the MongoEngine
interface, but may not be present if you are trying to use MongoEngine with
an existing database. For this reason, you may disable this inheritance
mechansim, removing the dependency of <tt class="xref py py-attr docutils literal"><span class="pre">_cls</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">_types</span></tt>, enabling
you to work with existing databases. To disable inheritance on a document
class, set <tt class="xref py py-attr docutils literal"><span class="pre">allow_inheritance</span></tt> to <tt class="docutils literal"><span class="pre">False</span></tt> in the <tt class="xref py py-attr docutils literal"><span class="pre">meta</span></tt>
dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Will work with data in an existing collection named &#39;cmsPage&#39;</span>
<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;collection&#39;</span><span class="p">:</span> <span class="s">&#39;cmsPage&#39;</span><span class="p">,</span>
        <span class="s">&#39;allow_inheritance&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining documents</a><ul>
<li><a class="reference internal" href="#defining-a-document-s-schema">Defining a document&#8217;s schema</a></li>
<li><a class="reference internal" href="#dynamic-document-schemas">Dynamic document schemas</a></li>
<li><a class="reference internal" href="#fields">Fields</a><ul>
<li><a class="reference internal" href="#field-arguments">Field arguments</a></li>
<li><a class="reference internal" href="#list-fields">List fields</a></li>
<li><a class="reference internal" href="#embedded-documents">Embedded documents</a></li>
<li><a class="reference internal" href="#dictionary-fields">Dictionary Fields</a></li>
<li><a class="reference internal" href="#reference-fields">Reference fields</a><ul>
<li><a class="reference internal" href="#one-to-many-with-listfields">One to Many with ListFields</a></li>
<li><a class="reference internal" href="#dealing-with-deletion-of-referred-documents">Dealing with deletion of referred documents</a></li>
<li><a class="reference internal" href="#generic-reference-fields">Generic reference fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uniqueness-constraints">Uniqueness constraints</a></li>
<li><a class="reference internal" href="#skipping-document-validation-on-save">Skipping Document validation on save</a></li>
</ul>
</li>
<li><a class="reference internal" href="#document-collections">Document collections</a><ul>
<li><a class="reference internal" href="#capped-collections">Capped collections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexes">Indexes</a><ul>
<li><a class="reference internal" href="#geospatial-indexes">Geospatial indexes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ordering">Ordering</a></li>
<li><a class="reference internal" href="#shard-keys">Shard keys</a></li>
<li><a class="reference internal" href="#document-inheritance">Document inheritance</a><ul>
<li><a class="reference internal" href="#working-with-existing-data">Working with existing data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="connecting.html"
                        title="previous chapter">Connecting to MongoDB</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="document-instances.html"
                        title="next chapter">Documents instances</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/guide/defining-documents.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="document-instances.html" title="Documents instances"
             >next</a> |</li>
        <li class="right" >
          <a href="connecting.html" title="Connecting to MongoDB"
             >previous</a> |</li>
        <li><a href="../index.html">LethusBox  documentation</a> &raquo;</li>
          <li><a href="index.html" >User Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2013, Lethus Tecnologia da Informação.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>