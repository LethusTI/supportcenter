(function(c){jQuery.fn.dataTableExt.oApi.fnSetFilteringDelay=function(f,e){var d=this,e=(typeof e=="undefined")?1000:e;c(this).each(function(h){c.fn.dataTableExt.iApiIndex=h;var k=this,g=null,l=null,j=c("input",d.fnSettings().aanFeatures.f);j.unbind("keyup").bind("keyup",function(){var m=k;if(l===null||l!=j.val()){window.clearTimeout(g);l=j.val();g=window.setTimeout(function(){c.fn.dataTableExt.iApiIndex=h;d.fnFilter(j.val())},e)}});return this});return this};var a=function(d,g){var f=c(d);var h=this;var g=g;var e=".";f.find(".button-icon").each(function(k,m){var l=c(m).attr("rev");c(m).button({icons:{primary:l}})});c(".alone-action, .many-action").hide();c("a.alone-action").click(function(l){l.preventDefault();var k=c(this).attr("href").replace("%d",g.getSeletedIds()[0]);if(c(this).hasClass("modal")){c("#dialog").ifdialog(k,{onClose:function(m){g.reload()}})}else{window.location.href=k}return false});function j(k){if(k.error){c.message(k.error,"error");return}g.reload()}c("#post-delete").click(function(k){ids=g.getSeletedIds();if(ids.length==0){return}if(ids.length==1){var l="Tem certeza que deseja apagar esse registro ?"}else{var l="Tem certeza que deseja apagar esses "+ids.length+" registros ?"}c("#dialog-confirm").attr("title","Aviso");c("#dialog-confirm #message").text(l);c("#dialog-confirm").dialog({resizable:false,height:160,modal:true,buttons:{Cancelar:function(){c(this).dialog("close")},Apagar:function(){c(this).dialog("close");c.post(e,{cmd:"mass_delete",ids:ids},j)}}})});c("#set-active").click(function(k){k.preventDefault();ids=g.getSeletedIds();if(ids.length==0){return}c.post(e,{cmd:"set_active",ids:ids},j);return false});c("#set-inactive").click(function(k){k.preventDefault();ids=g.getSeletedIds();if(ids.length==0){return}c.post(e,{cmd:"set_inactive",ids:ids},j);return false})};var b=function(f,e){var j=c(f);var k=this;this.settings=c.extend({form:null,listFormat:[],toolbar:"#toolbar",selectable:true,hiddenId:true,serverSide:true,filterSuport:true,scrollY:500,paginate:true,lengthChange:true,},e||{});var g=[];this.reload=function(){k.oTable.fnDraw();d()};this.getSeletedIds=function(){objs=j.find("tr.row_selected");ids=[];objs.each(function(l){ids[ids.length]=k.oTable.fnGetData(objs[l])[0]});return ids};function d(){var l=k.getSeletedIds().length;if(l<1){c(".alone-action").hide();c(".many-action").hide()}else{if(l==1){c(".alone-action").show();c(".many-action").show()}else{c(".alone-action").hide();c(".many-action").show()}}}this.init=function(){var m=[];var q=[];var l={};var p=-1;ths=j.find("thead th");data=j.find("thead th.boolean");if(data){var n=[];data.each(function(s,r){n[n.length]=ths.index(r)});m.push({fnRender:function(r){if(r.aData[r.iDataColumn]){return'<span class="ui-icon ui-icon-check" />'}else{return'<span class="ui-icon ui-icon-close" />'}},aTargets:n})}data=j.find("thead th.email");if(data){var n=[];data.each(function(s,r){n[n.length]=ths.index(r)});m.push({fnRender:function(r){return c.buildEmail(r.aData[r.iDataColumn])},aTargets:n})}data=j.find("thead th.sort-desc");if(data){data.each(function(s,r){q.push([ths.index(r),"desc"])})}data=j.find("thead th.sort-asc");if(data){data.each(function(s,r){q.push([ths.index(r),"asc"])})}data=j.find("thead th.class");if(data){p=ths.index(data.first())}data=j.find("thead th.link");if(data){var n=[];data.each(function(u,t){var s=ths.index(t);var r=parseInt(c(t).attr("rel"));n.push(r);l[r]=s});m.push({fnRender:function(r){var t=l[r.iDataColumn];var s=r.aData[t];var u=r.aData[r.iDataColumn];if(s){return'<a href="'+s+'">'+u+"</a>"}return u},aTargets:n})}var o={bJQueryUI:true,sScrollY:k.settings.scrollY,sPaginationType:"full_numbers",bServerSide:k.settings.serverSide,bFilter:k.settings.filterSuport,bLengthChange:k.settings.lengthChange,bPaginate:k.settings.paginate,aoColumnDefs:m,aaSorting:q,fnRowCallback:function(u,t,s,r){if(p>-1){c(u).addClass(t[p])}if(jQuery.inArray(t[0],g)!=-1){c(u).addClass("row_selected")}return u},oLanguage:{sProcessing:"Processando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"Não foram encontrados resultados",sInfo:"Mostrando de _START_ até _END_ de _TOTAL_ registros",sInfoEmpty:"Mostrando de 0 até 0 de 0 registros",sInfoFiltered:"(filtrado de _MAX_ registros no total)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",oPaginate:{sFirst:"Primeiro",sPrevious:"Anterior",sNext:"Seguinte",sLast:"Último"}}};if(k.settings.serverSide){o.sAjaxSource=".";o.fnServerData=function(r,s,t){s.push({name:"format",value:"data"});if(k.settings.form){s=c.merge(s,c(k.settings.form).serializeArray())}if(k.settings.getExtraData){s=c.merge(s,k.settings.getExtraData())}c.getJSON(r,s,function(u){if((u.messages)&&(u.messages.length>0)){for(i=0;i<u.messages.length;i=i+1){msg=u.messages[i];c.message(msg.message,msg.tags)}}t(u)})}}k.oTable=j.dataTable(o).fnSetFilteringDelay();if(p>-1){k.oTable.fnSetColumnVis(p,false)}if(k.settings.hiddenId){k.oTable.fnSetColumnVis(0,false)}if(l){for(i in l){k.oTable.fnSetColumnVis(l[i],false)}}if(k.settings.selectable){j.find("tbody tr").live("click",function(t){t.preventDefault();var s=k.oTable.fnGetData(this);if(!s){return}var v=s[0];var r=jQuery.inArray(v,g);if(r==-1){g.push(v)}else{g.splice(r,1)}if(!t){var t=window.event}var u=t.target?t.target:t.srcElement;if(c(u).is("a")){return}if(!t.ctrlKey){j.find("tbody tr.row_selected").removeClass("row_selected")}c(this).toggleClass("row_selected");d();return false}).live("dblclick",function(r){r.preventDefault();c("a.dblclick").trigger("click");return false})}k.destroy=function(){if(k.oTable){k.oTable.fnDestroy();k.oTable=null}j.find("tbody tr").empty()};c(".fg-toolbar").first().append(c("#toolbar2").remove());c("#select-all").click(function(r){r.preventDefault();j.find("tbody tr").addClass("row_selected");d();return false});c("#select-none").click(function(r){r.preventDefault();j.find("tbody tr.row_selected").removeClass("row_selected");d()})};c(k.settings.form).submit(function(l){l.preventDefault();k.reload();return false});c(k.settings.output).click(function(m){var n=c(k.settings.form).serializeJSON();var l=c(k.settings.form).attr("action");n.format=c(this).attr("rel");window.location.href=l+"?"+c.param(n);return false});k.init();var h=new a(k.settings.toolbar,k)};c.fn.listbuilder=function(d){var e=c(this);if(e.data("listbuilder")){return}var f=new b(this,d);e.data("listbuilder",f);return f}})(jQuery);